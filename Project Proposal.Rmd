---
title: "How do library resources and infrastructure, financial investment and community characteristics predict the number of library visits per year?"
author: "Isabella, Isla, Tala"
output:
  pdf_document:
    latex_engine: xelatex
    includes: null
header-includes:
  - \usepackage{float}
date: "2025-10-21"
margin: 1 cm
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

For our project, we are interested in understanding how we can predict the annual number of visitors to a library by examining the effects of a wide range of predictors, such as the size of the physical and digital collection, programs offered and their geographic locations in proximity to urban areas. 

## Literature Summary

An important predictor is total expenditure and resource investment which reflects a library’s capacity to maintain and expand user materials. Joo and Cahill (2017) found a strong correlation between expenditures, resources, and childrens' and young adults’ use, suggesting that higher investment may significantly increase annual visit frequency.

Additionally, annual website visits may also predict physical visits. According to Cheng et al. (2020), they identified that tailoring social media content and activity to their users’ needs increased engagement, potentially leading to more in-person visits. This provides theoretical support for using digital engagement metrics as predictors for user interest and likelihood of physical visits to libraries. We will also assess factors such as geographic locations, staff, programs, and services. Noh and Chang (2020) found that materials, facilities and interior design, space, staff, programs all significantly predicted user satisfaction and library use.

Collectively, prior literature supports that our predictors can influence library visits. We believe our findings could benefit both the public library users, and government agencies that fund them, as libraries provide a free, inclusive welcoming space for the public. If governments know how to best allocate funds and investments, they can ensure resources are effective in improving numbers of users and their experience (The Complicated Role of the Modern Public Library, n.d.).


## Sustainability of Linear Regression

A multiple linear regression model is preferred over non-modelling approaches because it quantifies how resource characteristics jointly influence visits rather than only describing associations. Most predictors are continuous, allowing straightforward estimation of linear relationships between predictors and the response variable. Moreover, previous studies have shown linear relationships between variables such as staffing and expenditure, supporting the model’s theoretical validity. The regression coefficients indicate how each predictor contributes to visit frequency while controlling other factors, whereas the interaction term captures how the effect of one factor depends on the level of another. The p-values and confidence intervals evaluate the statistical significance and precision of these effects, whereas the R² statistic summarizes how well the combined predictors explain the variation in visits across libraries.  

By quantifying these factors, the model helps decision makers identify which investments most effectively increase public engagement. Students and community members can also benefit from improved accessibility and allocation of library services based on the model’s findings.


# Data Description

The dataset was obtained from the Public Libraries Survey (PLS) 2023, conducted annually by the Institute of Museum and Library Services (IMLS) in the United States. The PLS was originally designed to provide standardized national data on public library operations, such as visits, staffing, and expenditures, to support policy and service improvement (Public Libraries Survey (PLS), n.d.). Data is collected through an annual national census survey of public libraries, self-reported by each library and verified by state data coordinators via a centralized web-based system.

## Variable Summaries

```{r cleaning_code, echo=FALSE, eval=TRUE, include=FALSE}
# loading and cleaning data 
library(tidyverse)
library(dplyr)
library(tidyr)
library(ggplot2)
library(purrr)
library(knitr)


rawdata <- read.csv(file ="PLS_FY23_AE_pud23i.csv")
# extract relevant predictors
rawdata1 <- subset(as.data.frame(rawdata), select = c(VISITS, LIBNAME, HRS_OPEN, TOTSTAFF, TOTPHYS, EBOOK, TOTPRO, TOTATTEN, STAFFEXP, TOTEXPCO,POPU_LSA, WEBVISIT, GPTERMS, LOCALE_MOD))
# merge categorical variables
rawdata1 <- rawdata1 %>%
  mutate(
    LOCALE_GROUP = case_when(
      LOCALE_MOD %in% c(11, 12, 13) ~ "Urban",
      LOCALE_MOD %in% c(21, 22, 23) ~ "Suburban",
      LOCALE_MOD %in% c(31, 32, 33) ~ "Town",
      LOCALE_MOD %in% c(41, 42, 43) ~ "Rural",
      TRUE ~ NA_character_  
    ),
    LOCALE_GROUP = factor(LOCALE_GROUP,
                          levels = c("Urban", "Suburban", "Town", "Rural"))
  )
table(rawdata1$LOCALE_GROUP)
str(rawdata1$LOCALE_GROUP)
sum(is.na(rawdata1$LOCALE_GROUP))
# Clean the data
# Step 1: Replace invalid codes (-1, -3, -9) with actual NA
rawdata1[rawdata1 == -1] <- NA
rawdata1[rawdata1 == -3] <- NA
rawdata1[rawdata1 == -9] <- NA
rawdata1[rawdata1 == -4] <- NA
# Step 2: Check missing counts
colSums(is.na(rawdata1))
# Step 3: Remove rows containing NA
clean_data <- na.omit(rawdata1)
# Step 4: Confirm number of rows left
nrow(clean_data)
# characteristics 
cont_vars <- c("HRS_OPEN","TOTSTAFF","TOTPHYS","EBOOK","TOTPRO",
               "TOTATTEN","STAFFEXP","TOTEXPCO",
               "POPU_LSA","WEBVISIT","GPTERMS","VISITS")
sum_table <- clean_data %>%
  select(all_of(cont_vars)) %>%
  pivot_longer(everything(), names_to = "variable", values_to = "value") %>%
  group_by(variable) %>%
  summarise(
    n = n(),
    min = round(min(value, na.rm=TRUE),0),
    q1 = round(quantile(value, 0.25, na.rm=TRUE),0),
    median = round(median(value, na.rm=TRUE),0),
    mean = round(mean(value, na.rm=TRUE),0),
    q3 = round(quantile(value, 0.75, na.rm=TRUE),0),
    max = round(max(value, na.rm=TRUE),0)
  )
print(sum_table)
table(clean_data$LOCALE_GROUP)
hist(clean_data$VISITS[clean_data$VISITS], breaks = 50,
     main = "Distribution of VISITS", xlab = "Number of Visits",
     col = "skyblue", border = "white") 
hist(clean_data$VISITS[clean_data$VISITS < 6e5], breaks = 50,
     main = "Distribution of VISITS (<600k)", xlab = "Number of Visits",
     col = "skyblue", border = "white")
boxplot(VISITS ~ LOCALE_GROUP, data = clean_data,
        main = "Visits by Location Type",
        xlab = "Locale", ylab = "Number of Visits", col = "lightblue")
ggplot(clean_data[clean_data$TOTPRO < 20000, ], 
       aes(x = TOTPRO, y = VISITS, color = LOCALE_GROUP)) +
  geom_point(alpha = 0.3) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "Programs vs. Visits by Locale (<20k Programs)", 
       x = "Programs Offered", y = "Visits", color = "Locale") +
  theme_minimal()
## Scatter plots for key numerical predictors vs VISITS
# Define the key predictors
key_predictors <- c("TOTPRO", "STAFFEXP", "TOTPHYS")
# Loop through each predictor to make scatter plots
for (var in key_predictors) {
  p <- ggplot(clean_data, aes_string(x = var, y = "VISITS")) +
    geom_point(alpha = 0.3, color = "steelblue") +
    geom_smooth(method = "lm", se = FALSE, color = "darkred") +
    labs(
      title = paste("Relationship between", var, "and VISITS"),
      x = var,
      y = "Number of Visits"
    ) +
    theme_minimal(base_size = 13)
  print(p)
}
```

After merging categorical location codes and removing missing values, the final dataset includes 5,110 observations, 12 numerical predictors, and one categorical variable, LOCALE_GROUP, indicating 4 library’s location types. The response variable, VISITS, measures annual physical library visits. As a continuous, non-negative variable roughly proportional to library scale, VISITS is suitable for linear regression analysis.

Table 1 provides a numerical summary of all continuous predictors and response variable. Most numerical variables exhibit large ranges and standard deviations, suggesting substantial variation and the presence of outliers. In several variables, the mean exceeds the median, confirming right-skewness.
```{r table1, echo=FALSE, fig.align='center'}

cont_vars <- c("HRS_OPEN","TOTSTAFF","TOTPHYS","EBOOK","TOTPRO",
               "TOTATTEN","STAFFEXP","TOTEXPCO",
               "POPU_LSA","WEBVISIT","GPTERMS","VISITS")

sum_table <- clean_data %>%
  select(all_of(cont_vars)) %>%
  pivot_longer(everything(), names_to = "Variables", values_to = "value") %>%
  group_by(Variables) %>%
  summarise(
    Min = round(min(value, na.rm = TRUE),0),
    Max = round(max(value, na.rm = TRUE),0),
    Mean= round(mean(value, na.rm = TRUE), 0),
    `Interquartile Range` = round(IQR(value, na.rm = TRUE), 2),
    Median = median(value, na.rm = TRUE),
    `Standard deviation` = round(sd(value, na.rm = TRUE), 2)
  ) %>%
  mutate(
    Variables = recode(Variables,
      "HRS_OPEN"  = "Total Annual Hours Open",
      "TOTSTAFF"  = "Full-time Staff",
      "TOTPHYS"   = "Total Physical Collection Size",
      "EBOOK"     = "Ebooks",
      "TOTPRO"    = "# of Synchronous Programs",
      "TOTATTEN"  = "# Attendance at Synchronous Programs",
      "STAFFEXP"  = "Staff Expenditure",
      "TOTEXPCO"  = "Collection Expenditures",
      "POPU_LSA"  = "Population Served",
      "WEBVISIT"  = "Website Visits",
      "GPTERMS"   = "# of Computers Available",
      "VISITS"    = "Total Visits"
    )
  )

kable(sum_table, caption = "Numerical summaries of the location and spread of the data")
``` 

Figure 1 shows the distribution of VISITS, which is highly right-skewed, indicating that most libraries have moderate visitor counts while a few receive extremely high visits.
```{r fig1, echo=FALSE, fig.cap="Distribution of VISITS", fig.width=6, fig.height=4, fig.align='center', fig.pos='H'}
hist(clean_data$VISITS[clean_data$VISITS], breaks = 50,
     main = "Distribution of VISITS", xlab = "Number of Visits",
     col = "skyblue", border = "white")
```

Figure 2 compares VISITS across location types, where Urban libraries have the highest medians and greatest variability, while Town and Rural libraries show lower and more consistent levels. This supports including LOCALE_GROUP  as a categorical predictor in the regression.

Figure 3 presents the relationship between number od programs and VISITS by locale.The positive slopes across all groups indicate that offering more programs increases visits, with steeper slopes for Urban and Suburban libraries. This suggests an interaction effect between program and location, which will be incorporated into the preliminary regression model.

```{r fig2, echo=FALSE, fig.cap="Visits by Location Type", fig.width=6, fig.height=4, fig.align='center', fig.pos='H'}
boxplot(VISITS ~ LOCALE_GROUP, data = clean_data,
        main = "Visits by Location Type",
        xlab = "Locale", ylab = "Number of Visits",
        col = "lightblue")
```

```{r fig3, echo=FALSE, fig.cap="Programs vs. Visits by Locale (<20k Programs)", fig.width=5.5, fig.height=3.5,fig.align='center',message = FALSE, warning = FALSE, fig.pos = 'H' }
ggplot(clean_data[clean_data$TOTPRO < 20000, ], aes(x = TOTPRO, y = VISITS, color = LOCALE_GROUP)) +
  geom_point(alpha = 0.3) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Programs Offered", y = "Visits", color = "Locale") +
  theme_minimal(base_size = 10)+
  theme(
    legend.position = c(0.8, 0.8),
    legend.background = element_rect(fill = alpha('white', 0.6), color = NA),
    legend.title = element_text(size = 9),
    legend.text = element_text(size = 8)
  )
```



# Ethics Discussion

# Preliminary Model Results

```{r preliminary model plots, echo=FALSE}
# initial linear model 
initial_model <- lm(VISITS ~ TOTSTAFF + TOTPHYS + EBOOK + TOTPRO + TOTATTEN + STAFFEXP +  TOTEXPCO + POPU_LSA + WEBVISIT + GPTERMS + HRS_OPEN, data = clean_data)
summary(initial_model)
      
   
```


# Analysis and Team Plan

## Analysis Plan

## Team Plan

# Bibliography

Cheng, W. W. H., Lam, E. T. H., & Chiu, D. K. (2020). Social media as a platform in academic library marketing: A comparative study. The Journal of Academic Librarianship, 46(5), 102188. https://doi.org/10.1016/j.acalib.2020.102188

Howard, J. (2019, Fall). The complicated role of the modern public library. National 
Endowment for the Humanities.
https://www.neh.gov/article/complicated-role-modern-public-library

Joo, S., & Cahill, M. (2017). The relationships between the expenditures and resources of
public libraries and children’s and young adults’ use: An exploratory analysis of
Institute of Museum and Library Services public library statistics data. Journal of
Librarianship and Information Science, 51(2), 307–316.
https://doi.org/10.1177/0961000617709057

Noh, Y., & Chang, R. (2020). A study on the factors of public library use by residents.
Journal of Librarianship and Information Science, 52(4),
1110–1125.https://doi.org/10.1177/0961000620903772

Public Libraries Survey (PLS). (n.d.). Institute of Museum and Library Services.
https://www.imls.gov/research-evaluation/surveys/public-libraries-survey-pls







